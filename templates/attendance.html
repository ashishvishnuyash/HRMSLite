{% extends "base.html" %}
{% load static %}
{% block title %}Attendance - HRMS Lite{% endblock %}
{% block content %}
<h1 class="mb-4">Attendance Management</h1>

<div class="card border-secondary bg-dark mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Mark Attendance</h5>
    <form id="attendance-form" class="row g-3" style="max-width: 28rem;">
      <div class="col-12">
        <label for="mark-employee" class="form-label">Employee <span class="text-danger">*</span></label>
        <select class="form-select bg-dark border-secondary text-body" id="mark-employee" name="employee" required>
          <option value="">-- Select employee --</option>
        </select>
      </div>
      <div class="col-12 col-md-6">
        <label for="mark-date" class="form-label">Date <span class="text-danger">*</span></label>
        <input type="date" class="form-control bg-dark border-secondary text-body" id="mark-date" name="date" required>
      </div>
      <div class="col-12 col-md-6">
        <label for="mark-status" class="form-label">Status <span class="text-danger">*</span></label>
        <select class="form-select bg-dark border-secondary text-body" id="mark-status" name="status" required>
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
        </select>
      </div>
      <div id="mark-form-error" class="col-12 alert alert-danger py-2 d-none" role="alert"></div>
      <div class="col-12">
        <button type="submit" class="btn btn-info text-dark">Mark Attendance</button>
      </div>
    </form>
  </div>
</div>

<div class="card border-secondary bg-dark">
  <div class="card-body">
    <h5 class="card-title mb-3">View Attendance Records</h5>

    <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
      <div class="flex-grow-1" style="min-width: 140px;">
        <label for="filter-employee" class="form-label small mb-0">Employee</label>
        <select class="form-select form-select-sm bg-dark border-secondary text-body" id="filter-employee">
          <option value="">All employees</option>
        </select>
      </div>
      <div style="min-width: 140px;">
        <label for="filter-date" class="form-label small mb-0">Date</label>
        <input type="date" class="form-control form-control-sm bg-dark border-secondary text-body" id="filter-date">
      </div>
      <div style="min-width: 120px;">
        <label for="filter-date-from" class="form-label small mb-0">From</label>
        <input type="date" class="form-control form-control-sm bg-dark border-secondary text-body" id="filter-date-from">
      </div>
      <div style="min-width: 120px;">
        <label for="filter-date-to" class="form-label small mb-0">To</label>
        <input type="date" class="form-control form-control-sm bg-dark border-secondary text-body" id="filter-date-to">
      </div>
      <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-filter">Apply Filters</button>
    </div>

    <div id="attendance-loading" class="text-center py-5">
      <div class="spinner-border text-info" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2 text-body-secondary">Loading attendance...</p>
    </div>

    <div id="attendance-error" class="alert alert-danger text-center d-none" role="alert">
      <p class="mb-2 error-msg"></p>
      <button type="button" class="btn btn-outline-danger btn-sm" onclick="loadAttendance()">Retry</button>
    </div>

    <div id="attendance-empty" class="alert alert-secondary text-center d-none" role="status">
      No attendance records yet. Mark attendance above.
    </div>

    <div id="attendance-content" class="d-none">
      <p id="total-present-info" class="text-body-secondary small mb-2"></p>
      <div class="table-responsive">
        <table class="table table-dark table-hover table-striped align-middle">
          <thead class="table-secondary">
            <tr>
              <th>Employee</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="attendance-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{% static 'js/attendance.js' %}"></script>
{% endblock %}
